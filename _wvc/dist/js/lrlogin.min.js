!function e(o,t,n){function i(s,a){if(!t[s]){if(!o[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=t[s]={exports:{}};o[s][0].call(u.exports,(function(e){return i(o[s][1][e]||e)}),u,u.exports,e,o,t,n)}return t[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,o,t){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.login_controller=function(){return a};var i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var o=r();if(o&&o.has(e))return o.get(e);var t={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(t,s,a):t[s]=e[s]}t.default=e,o&&o.set(e,t);return t}(e("./util_domelement.js"));function r(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return r=function(){return e},e}var s="31373013-2296-4deb-a021-70399242ac00",a=a||{},l="https://dev-login.worldvision.ca",c=function(e){return"https://stg-svc.worldvision.ca/DonorService/api/profile/"+e+"/donorbasic"},u=null,d={appName:"worldvision-dev",customdomain:"dev-login.worldvision.ca",iframeSettings:{height:"100%",width:"100%",class:"iframe"}},f={},g=function(e){e?($("header").addClass("signedin"),$(".siteHeader-navItem.site-welcomeuser").removeClass("u-hide"),$(".nav-sub-menu").removeClass("u-hide")):($("header").removeClass("signedin"),$(".siteHeader-navItem.site-welcomeuser").addClass("u-hide"),$(".nav-sub-menu").addClass("u-hide"))},p=function(e,o){$("header.signedin span.txtUserName").html(" "+e)},m=function(e,o,t){$.ajax({url:c(e),type:"GET",datatype:"text",success:o,error:t})},v=function(e){null!=e.id?(localStorage.setItem("first_name",e.firstName),p(e.firstName,e.lastName),console.log("[DBG] -- Returning Donor Svc with success")):(console.log("The user information is not found from Donor Service"),console.log("[DBG] -- Returning Donor Svc with failed"))},h=function(e){console.log("Cannot retrieve user information from Donor Service"),console.log("LR has a data regarding this user, but Donor service is not aware of this person. Data Mismatch"),console.log("[DBG] -- Returning Donor Svc with failed")},y=function(e){console.log("Cannot retrieve the user profile from LR through the token."),console.log("[DBG] -- Returning LR GetProfile with failed"),S()},w=function(e){for(var o in["uid","refresh_token","expires_in","first_name"])localStorage.removeItem(o)},S=function(e){w();u.util.jsonpCall("https://dev-login.worldvision.ca/ssologin/logout",(function(e){e.ok&&$.ajax({type:"POST",url:"https://uat-my.worldvision.ca/api/lr/logout",crossDomain:!0,success:function(e){location.reload()},error:function(e){location.reload()},beforeSend:function(e){e.setRequestHeader("Accept-Language","en")}})}))};(a={init:function(){var e;for(e in this)if(this.hasOwnProperty(e)){var o=this[e];void 0!==o.init&&o.init()}}}).initLrWidget={init:function(){console.log("[DBG] ++ initLrWidget");var e={};e.apiKey=s,e.appName="worldvision-dev",e.hashTemplate=!0,e.verificationUrl=window.location,e.resetPasswordUrl=window.location,e.forgotPasswordUrl="https://my.worldvision.ca/Home/ResetPassword";var o=new LoginRadiusV2(e);new LoginRadiusCiamWidget(d,f).render("login","login-iframe","auth.aspx",(function(e){if(null!=e.response&&null!=e.response.Profile){var o=e.response.Profile.Uid;localStorage.setItem("uid",o),localStorage.setItem("refresh_token",e.response.refresh_token),localStorage.setItem("expires_in",e.response.expires_in),localStorage.setItem("first_name",e.response.Profile.FirstName),console.log("[DBG] ++ Calling Donor Svc..."),m(o,v,h)}}));o.util.jsonpCall("https://dev-login.worldvision.ca/ssologin/login",(function(e){if(console.log("[DBG] Is Authenticated?????"),console.log(e.isauthenticated),e.isauthenticated){g(!0);var o=localStorage.getItem("first_name");null!=o&&null!=o?p(o):(t=e.token,n=function(e){null!=e&&(p(e.FirstName),localStorage.setItem("uid",e.Uid),m(e.Uid,v,h))},i=y,r="https://api.loginradius.com/identity/v2/auth/account?apikey="+s+"&access_token="+t,$.ajax({url:r,type:"GET",datatype:"text",success:n,error:i})),function(e,o,t){$.ajax({url:"https://api.loginradius.com/identity/v2/auth/access_token/Validate?apikey=31373013-2296-4deb-a021-70399242ac00",type:"GET",datatype:"json",success:o,error:t,beforeSend:function(o){o.setRequestHeader("Authorization","Bearer "+e)}})}(e.token,(function(e){console.log(e)}),(function(e){console.log(e)}))}else g(!1),console.log("[DBG] -- Current user is not authenticated"),w();var t,n,i,r}));var t={onError:function(){localStorage.setItem("loginRadiusSSO","false")},onSuccess:function(){localStorage.setItem("loginRadiusSSO","true")}};o.util.ready((function(){o.init("ssoNotLoginThenLogout",t)})),u=o}},a.initLoginModal={selector:"#btnMwvLogin-Desktop, #btnMwvLogin-Mobile",init:function(){var e=self.window;$(this.selector).on("keypress click",(function(o){if(13===o.which||"click"===o.type){o.preventDefault();var t=e.document.querySelector(".lr-login"),n=e.document.querySelector(".login-modal");if(n.dataset.show="".concat(!i.is_visible(n)),"true"===n.dataset.show){n.classList.remove("u-hide"),t.classList.remove("u-hide");var r=document.getElementById("#login-iframe iframe.iframe");$(r).contents().find("#loginradius-login-emailid").focus()}$("nav.siteHeader-nav").hasClass("show")}}))}},a.clickCloseLoginModal={init:function(){$(".lr-login .lr-modal-overlay, #btnCloseLoginMenu").on("click",(function(){$(".lr-login").addClass("u-hide"),$(".login-modal").addClass("u-hide");var e=$(".main-nav"),o=$("#btnMwvLogin-Mobile"),t=$("#btnMwvLogin-Desktop");"mobile"===e.attr("data-open-by")?o.focus():t.focus()}))}},a.initLogout={selector:"#sidenavMwvLogout",init:function(){self.window;$(this.selector).on("keypress click",(function(e){13!==e.which&&"click"!==e.type||(e.preventDefault(),S())}))}},a.processPostMessage={init:function(){window.addEventListener("message",(function(e){e.origin!==l||"success"===jQuery.parseJSON(e.data).data.status.toLowerCase()&&(localStorage.setItem("loginRadiusResponse",JSON.stringify(e)),localStorage.setItem("loginRadiusSSO","true"),location.reload())}))}}},{"./util_domelement.js":2}],2:[function(e,o,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.is_visible=function(e){return null!==e.offsetParent},t.in_viewport=function(e,o){var t=e.document.documentElement,n=t.clientWidth,i=t.clientHeight,r=o.getBoundingClientRect();return r.top>=0&&r.left>=0&&r.right<=n&&r.bottom<=i}},{}]},{},[1]);